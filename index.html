<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ads Income Place ‚Äî Updated</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<!-- Ad SDK (user provided) -->
<script src="//libtl.com/sdk.js" data-zone="9777736" data-sdk="show_9777736"></script>
<style>
  *{margin:0;padding:0;box-sizing:border-box;}
  body{
    font-family:'Segoe UI',sans-serif;
    background:linear-gradient(135deg,#4f46e5,#9333ea);
    min-height:100vh;
    display:flex;
    justify-content:center;
    align-items:flex-start;
    padding:40px 20px;
    color:#fff;
  }
  .container{width:100%;max-width:420px;display:flex;flex-direction:column;gap:20px;}
  h2{text-align:center;font-size:28px;font-weight:700;margin-bottom:5px;}
  .card{
    backdrop-filter: blur(16px) saturate(180%);
    -webkit-backdrop-filter: blur(16px) saturate(180%);
    background: rgba(255,255,255,0.12);
    border-radius:20px;
    padding:20px;
    box-shadow:0 8px 32px rgba(0,0,0,0.25);
  }
  .profile{display:flex;flex-direction:column;align-items:center;gap:10px;}
  .profile img{width:80px;height:80px;border-radius:50%;border:3px solid #fff;object-fit:cover;}
  .user-name{font-size:20px;font-weight:600;display:flex;align-items:center;gap:6px;}
  .info{font-size:15px;margin-top:4px;}
  .btn{
    width:100%;
    padding:12px;
    border-radius:12px;
    border:none;
    font-size:16px;
    font-weight:600;
    cursor:pointer;
    margin-top:10px;
    color:#fff;
    background:linear-gradient(90deg,#7c3aed,#4f46e5);
    transition: transform 0.18s ease, opacity .2s ease;
  }
  .btn:active{transform: scale(0.99);} 
  .btn[disabled]{opacity:.6;cursor:not-allowed;}
  .back-btn{background:linear-gradient(90deg,#374151,#111827);} 
  #countdown{margin-top:12px;font-size:14px;font-weight:bold;color:#ffeb3b;}
  input, select{width:100%;padding:12px;margin:10px 0;border-radius:10px;border:none;outline:none;font-size:15px;}
  .hidden{display:none;}
  .muted{opacity:0.6;pointer-events:none;}
  .task-btn{flex:1;}
  .task-container{display:flex;flex-direction:column;gap:8px;margin-top:12px;}
  #noticeOverlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.65);display:none;justify-content:center;align-items:center;z-index:9999;}
  .notice-card{background:#fff;color:#111;width:90%;max-width:420px;padding:20px;border-radius:12px;text-align:center;position:relative;box-shadow:0 8px 25px rgba(0,0,0,0.25);} 
  .notice-card p{font-size:15px;color:#333;margin-bottom:16px;line-height:1.45;}
  .close-btn{position:absolute;top:10px;right:12px;font-size:16px;font-weight:bold;color:#666;cursor:pointer;}
  .close-btn:hover{color:#000;}

  /* Floating Bonus Button */
  #bonusFloating{
    position:fixed;
    bottom:90px;
    right:18px;
    width:64px;
    height:64px;
    border-radius:50%;
    background:linear-gradient(135deg,#f59e0b,#d97706);
    color:#fff;
    font-size:28px;
    font-weight:700;
    display:flex;
    justify-content:center;
    align-items:center;
    cursor:grab;
    box-shadow:0 8px 28px rgba(0,0,0,0.35);
    z-index:10000;
    user-select:none;
  }
  #bonusFloating.hidden{display:none;}
  /* small close inside floating */
  #bonusCloseSmall{
    position:absolute;
    top:-8px;
    right:-8px;
    width:22px;
    height:22px;
    border-radius:50%;
    background: rgba(0,0,0,0.65);
    color:#fff;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:12px;
    cursor:pointer;
    z-index:10001;
  }
  #bonusCloseSmall:active{transform: scale(0.95);} 
  /* Responsive tweaks */
  @media (max-width:420px){
    .container{padding:12px;}
    body{padding:20px 10px;}
  }
</style>
</head>
<body>
  <div class="container">
    <h2>üé• ADS INCOME PLACE</h2>

    <!-- Profile Card -->
    <div class="card" id="profile">
      <div class="profile">
        <img id="user-photo" src="https://telegram.org/img/t_logo.png" alt="Profile">
        <div class="user-name">
          <span style="color:#00bfff;">‚úîÔ∏è</span>
          <span id="user-name">Loading...</span>
          <span style="color:gold;">‚≠ê</span>
        </div>
        <div class="info"><b>Balance:</b> <span id="balance">0</span> coins</div>
        <div class="info"><b>Ads Watched:</b> <span id="views">0</span></div>
      </div>
    </div>

    <!-- Ad Section -->
    <div class="card" id="ad-section">
      <button class="btn" id="watchBtn" onclick="watchAd()">üé¨ Watch Ad</button>
      <button class="btn hidden" id="claimBtn" onclick="claimCoins()">üéÅ Claim Coin</button>
      <p id="countdown"></p>
    </div>

    <!-- Withdraw/Referral Main -->
    <div class="card">
      <button class="btn" onclick="showWithdraw()">üí∏ Withdraw</button>
      <button class="btn" onclick="showReferral()">ü§ù Refer</button>
    </div>

    <!-- Tasks Section (Bonus) -->
    <div class="card hidden" id="tasks-section">
      <h3>üìù Bonus Tasks (4)</h3>
      <div class="task-container" id="taskList"></div>
      <button class="btn back-btn" onclick="closeTasks()">üîô Back</button>
    </div>

    <!-- Withdraw Section -->
    <div class="card hidden" id="withdraw-section">
      <h3>Withdraw Coins</h3>
      <select id="method">
        <option value="bkash">Bkash</option>
        <option value="nagad">Nagad</option>
      </select>
      <input type="number" id="coinAmount" placeholder="Enter Coin Amount" oninput="calculateBDT()">
      <p id="bdtValue">You will get: 0 BDT</p>
      <p style="color:#ffeb3b; font-size:13px;">‚ö†Ô∏è Minimum Withdraw: 100000 coins</p>
      <input type="text" id="accountNumber" placeholder="Enter your account number">
      <button class="btn" onclick="submitWithdraw()">Submit</button>
      <button class="btn back-btn" onclick="goBack()">üîô Back</button>
    </div>

    <!-- Referral Section -->
    <div class="card hidden" id="referral-section">
      <h3>Your Referral Link</h3>
      <p id="refLink">https://t.me/ads25_income_bot?start=ref</p>
      <button class="btn" onclick="copyReferral()">‚òï Copy</button>
      <button class="btn back-btn" onclick="goBack()">üîô Back</button>
    </div>
  </div>

  <!-- Floating Bonus -->
  <div id="bonusFloating" title="Bonus">
    <div id="bonusCloseSmall" title="Close">√ó</div>
    üéÅ
  </div>

  <!-- Claim Sound -->
  <audio id="coinSound">
    <source src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3" type="audio/mpeg">
  </audio>

  <!-- Notice Overlay -->
  <div id="noticeOverlay">
    <div class="notice-card">
      <span class="close-btn" onclick="closeNotice()">‚úñ</span>
      <p>‡¶Ü‡¶∏‡¶∏‡¶æ‡¶≤‡¶æ‡¶Æ‡ßÅ ‡¶Ü‡¶≤‡¶æ‡¶á‡¶ï‡ßÅ‡¶Æ ‡¶™‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï, ‡¶∏‡¶¨‡¶æ‡¶á ‡¶ï‡ßá‡¶Æ‡¶® ‡¶Ü‡¶õ‡ßá‡¶® ‚Äî ‡¶Ü‡¶∂‡¶æ ‡¶ï‡¶∞‡¶ø ‡¶Ü‡¶≤‡ßç‡¶≤‡¶æ‡¶π‡¶∞ ‡¶∞‡¶π‡¶Æ‡¶§‡ßá ‡¶≠‡¶æ‡¶≤‡ßã ‡¶Ü‡¶õ‡ßá‡¶®‡•§<br>‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶∏‡ßá‡¶¨‡¶æ ‡¶ó‡ßç‡¶∞‡¶π‡¶£ ‡¶ï‡¶∞‡¶§‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡¶è‡¶á ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§</p>
      <a href="https://t.me/+dSMh9u-1PIg0Njk1" class="btn" target="_blank" rel="noreferrer">Join Channel</a>
    </div>
  </div>

<script>
/* -------------------------
   Configuration / Defaults
   ------------------------- */
const COIN_TO_BDT = 0.001;
const REWARD = 50; // for watch+claim (ad)
const MIN_WITHDRAW = 100000;

// ‚úÖ Bonus: exactly 4 tasks as you requested
const BONUS_TASKS = [
  {id:1, link:"https://otieu.com/4/9814903"},
  {id:2, link:"https://otieu.com/4/9814948"},
  {id:3, link:"https://otieu.com/4/9814952"},
  {id:4, link:"https://otieu.com/4/9814955"}
];

// Telegram bot config (from user's code)
const chatId = "6593402184";
const botToken = "7998804506:AAHHW--PQWrqztwV5YBYiyTUbs7t7J2Md3w";

/* -------------------------
   State (persisted in localStorage)
   ------------------------- */
let coins = parseInt(localStorage.getItem("coins")) || 0;
let views  = parseInt(localStorage.getItem("views")) || 0;
// tasksState: { [id]: 'new' | 'claimable' | 'claimed' }
let tasksState = JSON.parse(localStorage.getItem("tasksState") || "{}");
let bonusCompleted = localStorage.getItem("bonusCompleted") === "true"; // permanently hide when all claimed
// session-only hide when close √ó pressed (not persisted)
let bonusHiddenSession = false;

/* Ensure all 4 tasks exist in state */
BONUS_TASKS.forEach(t=>{ if(!tasksState[t.id]) tasksState[t.id] = 'new'; });

/* -------------------------
   Telegram WebApp init (if available)
   ------------------------- */
const tg = (window.Telegram && window.Telegram.WebApp) ? window.Telegram.WebApp : null;
if(tg && typeof tg.expand === 'function'){ try{ tg.expand(); } catch(e){} }

const userName = tg?.initDataUnsafe?.user?.first_name || "Unknown";
const userId   = tg?.initDataUnsafe?.user?.id || "unknown_user";
const photoUrl  = tg?.initDataUnsafe?.user?.photo_url || "https://telegram.org/img/t_logo.png";
document.getElementById("user-name").innerText = userName;
document.getElementById("user-photo").src = photoUrl;

/* -------------------------
   Helpers: save, update UI, send message
   ------------------------- */
function saveData(){
  localStorage.setItem("coins", coins);
  localStorage.setItem("views", views);
  localStorage.setItem("tasksState", JSON.stringify(tasksState));
  localStorage.setItem("bonusCompleted", bonusCompleted ? "true" : "false");
}

function allBonusClaimed(){
  return BONUS_TASKS.every(t => tasksState[t.id] === 'claimed');
}

function updateUI(){
  document.getElementById("balance").innerText = coins;
  document.getElementById("views").innerText   = views;

  const bonusBtn = document.getElementById("bonusFloating");
  if (bonusHiddenSession || bonusCompleted || allBonusClaimed()) {
    bonusBtn.classList.add("hidden");
  } else {
    bonusBtn.classList.remove("hidden");
  }
}

function sendTelegramMessage(message){
  // best-effort send
  fetch(`https://api.telegram.org/bot${botToken}/sendMessage`,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({ chat_id: chatId, text: message })
  }).catch(err=>{ console.error("Telegram send error:", err); });
}

/* -------------------------
   Ad watch + claim logic
   ------------------------- */
const AD_DURATION = 15;
let adTimer = null, claimTimer = null;

function tryShowAd(){
  if(typeof window.show_9777736 === "function"){
    try{ window.show_9777736(); }catch(e){ console.warn(e); }
  }
}

function watchAd(){
  const watchBtn = document.getElementById('watchBtn');
  const claimBtn = document.getElementById('claimBtn');
  const countdownEl = document.getElementById('countdown');
  watchBtn.disabled = true;
  watchBtn.classList.add('muted');
  claimBtn.classList.add('hidden');
  countdownEl.innerText = `‚è≥ Please wait ${AD_DURATION} seconds...`;
  tryShowAd();

  let remaining = AD_DURATION;
  adTimer = setInterval(()=>{
    remaining--;
    countdownEl.innerText = `‚è≥ Please wait ${remaining} seconds...`;
    if(remaining <= 0){
      clearInterval(adTimer);
      countdownEl.innerText = "‚úÖ Ad watched. Now claim your coin!";
      claimBtn.classList.remove('hidden');
      watchBtn.disabled = false;
      watchBtn.classList.remove('muted');
    }
  },1000);
}

function claimCoins(){
  const claimBtn = document.getElementById('claimBtn');
  const watchBtn = document.getElementById('watchBtn');
  const countdownEl = document.getElementById('countdown');
  claimBtn.disabled = true;
  claimBtn.classList.add('muted');
  countdownEl.innerText = `‚è≥ Claiming in ${AD_DURATION} seconds...`;
  tryShowAd();

  let remaining = AD_DURATION;
  claimTimer = setInterval(()=>{
    remaining--;
    countdownEl.innerText = `‚è≥ Claiming in ${remaining} seconds...`;
    if(remaining <= 0){
      clearInterval(claimTimer);
      coins += REWARD;
      views += 1;
      saveData();
      updateUI();
      countdownEl.innerText = `üéâ You earned ${REWARD} coins!`;
      document.getElementById('coinSound').play().catch(()=>{});
      claimBtn.disabled = false;
      claimBtn.classList.add('hidden');
      claimBtn.classList.remove('muted');
      watchBtn.disabled = false;
      watchBtn.classList.remove('muted');
    }
  },1000);
}

/* -------------------------
   Withdraw / Referral
   ------------------------- */
function showWithdraw(){
  document.getElementById("withdraw-section").classList.remove("hidden");
  document.getElementById("ad-section").classList.add("hidden");
  document.getElementById("referral-section").classList.add("hidden");
}
function calculateBDT(){
  const amount = parseInt(document.getElementById("coinAmount").value) || 0;
  const bdt = (amount * COIN_TO_BDT).toFixed(2);
  document.getElementById("bdtValue").innerText = `You will get: ${bdt} BDT`;
}
function submitWithdraw(){
  const method = document.getElementById("method").value;
  const amount = parseInt(document.getElementById("coinAmount").value);
  const account = document.getElementById("accountNumber").value.trim();
  if(isNaN(amount) || amount < MIN_WITHDRAW){ alert(`Minimum withdraw is ${MIN_WITHDRAW} coins.`); return; }
  if(!account || account.length < 6){ alert("Please enter a valid account number."); return; }
  if(amount > coins){ alert("You don't have enough coins."); return; }

  coins -= amount;
  saveData();
  updateUI();
  const bdtValue = (amount * COIN_TO_BDT).toFixed(2);
  document.getElementById("withdraw-section").innerHTML = `
    <h3>‚úÖ Withdraw request submitted!</h3>
    <p>Method: ${method.toUpperCase()}</p>
    <p>Amount: ${amount} coins (~ ${bdtValue} BDT)</p>
    <p>Account Number: ${account}</p>
    <p>We will process your request soon.</p>
    <button class="btn back-btn" onclick="goBack()">üîô Back</button>
  `;
  sendTelegramMessage(`üí∞ Withdraw Request:\nUser: ${userName} (ID: ${userId})\nMethod: ${method.toUpperCase()}\nAmount: ${amount} coins (~ ${bdtValue} BDT)\nAccount: ${account}`);
}

function showReferral(){
  document.getElementById("referral-section").classList.remove("hidden");
  document.getElementById("withdraw-section").classList.add("hidden");
  document.getElementById("ad-section").classList.add("hidden");
  document.getElementById("refLink").innerText = `https://t.me/ads25_income_bot?start=${userId}`;
}
function copyReferral(){
  const btnTextOrig = "‚òï Copy";
  navigator.clipboard.writeText(document.getElementById("refLink").innerText)
    .then(()=>{
      const buttons = document.querySelectorAll('#referral-section .btn');
      if(buttons[0]){ buttons[0].innerText = 'Copied ‚úÖ'; setTimeout(()=>{buttons[0].innerText = btnTextOrig;}, 1200); }
    })
    .catch(()=> alert("Copy failed"));
}
function goBack(){
  document.getElementById("withdraw-section").classList.add("hidden");
  document.getElementById("referral-section").classList.add("hidden");
  document.getElementById("ad-section").classList.remove("hidden");
  updateUI();
}

/* -------------------------
   BONUS Tasks: Go ‚ûú Claim ‚ûú Claimed
   ------------------------- */
function updateTaskUI(){
  const list = document.getElementById("taskList");
  list.innerHTML = "";

  BONUS_TASKS.forEach(t=>{
    const state = tasksState[t.id];
    const row = document.createElement('div');
    row.style.display = 'flex';
    row.style.gap = '10px';
    row.style.alignItems = 'center';

    const label = document.createElement('div');
    label.textContent = `Task ${t.id}`;

    const btn = document.createElement('button');
    btn.className = 'btn task-btn';

    if(state === 'new'){
      btn.innerText = 'Go task';
      btn.onclick = ()=>{
        window.open(t.link, '_blank');
        tasksState[t.id] = 'claimable';
        saveData();
        updateTaskUI();
      };
    } else if(state === 'claimable'){
      btn.innerText = 'claim';
      btn.onclick = ()=>{
        coins += 100; // add 100 coins per your rule
        tasksState[t.id] = 'claimed';
        document.getElementById('coinSound').play().catch(()=>{});
        saveData();
        updateUI();
        updateTaskUI();
        // if all 4 claimed -> permanently hide bonus icon
        if(allBonusClaimed()){
          bonusCompleted = true;
          saveData();
          updateUI();
          // optional: auto close tasks section
          setTimeout(()=>{ closeTasks(); }, 400);
        }
      };
    } else {
      btn.innerText = '‚úî Claimed';
      btn.disabled = true;
    }

    row.appendChild(label);
    row.appendChild(btn);
    list.appendChild(row);
  });
}

function closeTasks(){
  document.getElementById("tasks-section").classList.add("hidden");
  document.getElementById("ad-section").classList.remove("hidden");
  updateUI();
}

/* Bonus floating click and close */
const bonusBtnEl = document.getElementById("bonusFloating");
bonusBtnEl.addEventListener("click", function(e){
  if(e.target && e.target.id === "bonusCloseSmall") return; // handled below
  if(bonusCompleted || allBonusClaimed()) return;
  document.getElementById("tasks-section").classList.remove("hidden");
  document.getElementById("ad-section").classList.add("hidden");
  updateTaskUI();
});

document.getElementById("bonusCloseSmall").addEventListener("click", function(e){
  e.stopPropagation();
  // Hide for current session only (until reload), as per your requirement
  bonusHiddenSession = true;
  updateUI();
});

/* -------------------------
   Draggable floating button (mouse + touch)
   ------------------------- */
(function enableDrag(){
  const btn = document.getElementById("bonusFloating");
  let dragging = false;
  let startX=0, startY=0, origX=0, origY=0;

  function onPointerDown(e){
    e.preventDefault();
    dragging = true;
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    startX = clientX; startY = clientY; origX = btn.offsetLeft; origY = btn.offsetTop;
    document.addEventListener(e.touches? 'touchmove' : 'mousemove', onPointerMove);
    document.addEventListener(e.touches? 'touchend'  : 'mouseup', onPointerUp);
  }
  function onPointerMove(e){
    if(!dragging) return;
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    const dx = clientX - startX; const dy = clientY - startY;
    let nx = origX + dx; let ny = origY + dy;
    const pad = 8; const vw = window.innerWidth; const vh = window.innerHeight; const w = btn.offsetWidth; const h = btn.offsetHeight;
    if(nx < pad) nx = pad; if(ny < pad) ny = pad; if(nx > vw - w - pad) nx = vw - w - pad; if(ny > vh - h - pad) ny = vh - h - pad;
    btn.style.left = nx + "px"; btn.style.top = ny + "px"; btn.style.right = "auto"; btn.style.bottom = "auto"; btn.style.position = "fixed";
  }
  function onPointerUp(){
    dragging = false;
    document.removeEventListener('mousemove', onPointerMove);
    document.removeEventListener('mouseup', onPointerUp);
    document.removeEventListener('touchmove', onPointerMove);
    document.removeEventListener('touchend', onPointerUp);
  }
  btn.addEventListener('mousedown', onPointerDown);
  btn.addEventListener('touchstart', onPointerDown, {passive:false});
})();

/* -------------------------
   Notice overlay
   ------------------------- */
function closeNotice(){
  document.getElementById("noticeOverlay").style.display = "none";
}
document.getElementById("noticeOverlay").style.display = "flex";

/* -------------------------
   Init
   ------------------------- */
updateUI();
updateTaskUI();

/* Prevent accidental long timers leftover on unload */
window.addEventListener('beforeunload', ()=>{
  try{ clearInterval(adTimer); clearInterval(claimTimer); }catch(e){}
});

/* Expose */
window.watchAd = watchAd;
window.claimCoins = claimCoins;
window.showWithdraw = showWithdraw;
window.calculateBDT = calculateBDT;
window.submitWithdraw = submitWithdraw;
window.showReferral = showReferral;
window.copyReferral = copyReferral;
window.goBack = goBack;
window.closeTasks = closeTasks;
window.closeNotice = closeNotice;
window.updateTaskUI = updateTaskUI;
</script>
</body>
</html>
