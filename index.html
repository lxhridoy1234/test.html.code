<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <title>Ads Income Place</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="//libtl.com/sdk.js" data-zone="9777736" data-sdk="show_9777736"></script>

  <style>
    * {margin: 0; padding: 0; box-sizing: border-box;}
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #4f46e5, #9333ea);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 40px 20px;
      color: #fff;
    }
    .container {width: 100%; max-width: 420px; display: flex; flex-direction: column; gap: 20px;}
    h2 {text-align: center; font-size: 28px; font-weight: 700; margin-bottom: 5px;}
    p.subtitle {text-align: center; color: #e0e0ff; font-size: 15px; margin-bottom: 15px;}
    .card {
      backdrop-filter: blur(16px) saturate(180%);
      -webkit-backdrop-filter: blur(16px) saturate(180%);
      background: rgba(255, 255, 255, 0.12);
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.25);
      transition: transform 0.25s ease;
    }
    .card:hover {transform: translateY(-4px);}
    .profile {display: flex; flex-direction: column; align-items: center; gap: 12px;}
    .profile img {width: 80px; height: 80px; border-radius: 50%; border: 3px solid #fff;}
    .user-name {font-size: 20px; font-weight: 600; display: flex; align-items: center; gap: 6px;}
    .verify-icon {color: #00bfff; font-size: 18px;}
    .premium-icon {color: gold; font-size: 18px;}
    .info {font-size: 15px; margin-top: 4px;}
    .btn {
      width: 100%;
      padding: 14px;
      border-radius: 12px;
      border: none;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 10px;
      color: #fff;
      background: linear-gradient(90deg, #7c3aed, #4f46e5);
      transition: all 0.3s ease;
    }
    .btn:hover {transform: scale(1.03);}
    .btn:active {transform: scale(0.98);}
    .back-btn {background: linear-gradient(90deg, #374151, #111827);}
    #countdown {margin-top: 12px; font-size: 14px; font-weight: bold; color: #ffeb3b;}
    input, select {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border-radius: 10px;
      border: none;
      outline: none;
      font-size: 15px;
    }
    .hidden {display: none;}
    .muted {opacity: 0.6; pointer-events: none;}
  </style>
</head>
<body>
  <div class="container">
    <h2>üé• ADS INCOME PLACE</h2>
    <p class="subtitle">Earn 50 coins after ad + claim</p>

    <!-- Profile Card -->
    <div class="card" id="profile">
      <div class="profile">
        <img id="user-photo" src="https://telegram.org/img/t_logo.png" alt="Profile">
        <div class="user-name">
          <span class="verify-icon">‚úîÔ∏è</span>
          <span id="user-name">Loading...</span>
          <span class="premium-icon">‚≠ê</span>
        </div>
        <div class="info"><b>Balance:</b> <span id="balance">0</span> coins</div>
        <div class="info"><b>Ads Watched:</b> <span id="views">0</span></div>
      </div>
    </div>

    <!-- Ad Section -->
    <div class="card" id="ad-section">
      <button class="btn" id="watchBtn" onclick="watchAd()">üé¨ Watch Ad</button>
      <button class="btn hidden" id="claimBtn" onclick="claimCoins()">üéÅ Claim Coin</button>
      <p id="countdown"></p>
    </div>

    <!-- Auto Ad Section -->
    <div class="card">
      <button class="btn" id="startAuto" onclick="startAutoAd()">‚ñ∂Ô∏è Start Auto Ad</button>
      <button class="btn back-btn hidden" id="stopAuto" onclick="stopAutoAd()">‚èπ Stop Auto Ad</button>
      <p id="autoStatus"></p>
    </div>

    <!-- Withdraw/Referral Main -->
    <div class="card">
      <button class="btn" onclick="showWithdraw()">üí∏ Withdraw</button>
      <button class="btn" onclick="showReferral()">ü§ù Refer</button>
    </div>

    <!-- Withdraw Section -->
    <div class="card hidden" id="withdraw-section">
      <h3>Withdraw Coins</h3>
      <select id="method">
        <option value="bkash">Bkash</option>
        <option value="nagad">Nagad</option>
      </select>
      <input type="number" id="coinAmount" placeholder="Enter Coin Amount" oninput="calculateBDT()">
      <p id="bdtValue">You will get: 0 BDT</p>
      <p style="color:#ffeb3b; font-size:13px;">‚ö†Ô∏è Minimum Withdraw: 100000 coins</p>
      <input type="text" id="accountNumber" placeholder="Enter your account number">
      <button class="btn" onclick="submitWithdraw()">Submit</button>
      <button class="btn back-btn" onclick="goBack()">üîô Back</button>
    </div>

    <!-- Referral Section -->
    <div class="card hidden" id="referral-section">
      <h3>Your Referral Link</h3>
      <p id="refLink">https://t.me/ads25_income_bot?start=ref</p>
      <button class="btn" onclick="copyReferral()">‚òï Copy</button>
      <button class="btn back-btn" onclick="goBack()">üîô Back</button>
    </div>
  </div>

  <audio id="coinSound">
    <source src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3" type="audio/mpeg">
  </audio>

  <script>
    const AD_DURATION = 15;
    const REWARD = 50;

    const tg = (window.Telegram && window.Telegram.WebApp) ? window.Telegram.WebApp : null;
    if (tg && typeof tg.expand === 'function') {
      try { tg.expand(); } catch (e) { console.log('tg.expand error', e); }
    }

    const userName = tg?.initDataUnsafe?.user?.first_name || "Unknown";
    const userId = tg?.initDataUnsafe?.user?.id || "unknown_user";
    const photoUrl = tg?.initDataUnsafe?.user?.photo_url || "https://telegram.org/img/t_logo.png";

    document.getElementById("user-name").innerText = userName;
    document.getElementById("user-photo").src = photoUrl;

    let coins = parseInt(localStorage.getItem("coins")) || 0;
    let views = parseInt(localStorage.getItem("views")) || 0;
    let adTimer = null;
    let claimTimer = null;
    let autoAdClaimTimeout = null;

    function updateUI() {
      document.getElementById("balance").innerText = coins;
      document.getElementById("views").innerText = views;
    }
    function saveData() {
      localStorage.setItem("coins", coins);
      localStorage.setItem("views", views);
    }

    function tryShowAd() {
      if (typeof window.show_9777736 === "function") {
        try { window.show_9777736(); } catch(e){ console.log('ad sdk error', e); }
      }
    }

    // Watch Ad
    function watchAd() {
      const watchBtn = document.getElementById('watchBtn');
      const claimBtn = document.getElementById('claimBtn');
      const countdownEl = document.getElementById('countdown');

      watchBtn.disabled = true;
      watchBtn.classList.add('muted');
      claimBtn.classList.add('hidden');
      countdownEl.innerText = `‚è≥ Please wait ${AD_DURATION} seconds...`;

      tryShowAd();

      let remaining = AD_DURATION;
      adTimer = setInterval(() => {
        remaining--;
        countdownEl.innerText = `‚è≥ Please wait ${remaining} seconds...`;
        if (remaining <= 0) {
          clearInterval(adTimer);
          adTimer = null;
          countdownEl.innerText = "‚úÖ Ad watched. Now claim your coin!";
          claimBtn.classList.remove('hidden');
          watchBtn.disabled = false;
          watchBtn.classList.remove('muted');
        }
      }, 1000);
    }

    function claimCoins() {
      const claimBtn = document.getElementById('claimBtn');
      const watchBtn = document.getElementById('watchBtn');
      const countdownEl = document.getElementById('countdown');

      claimBtn.disabled = true;
      claimBtn.classList.add('muted');
      countdownEl.innerText = `‚è≥ Claiming in ${AD_DURATION} seconds...`;

      tryShowAd();

      let remaining = AD_DURATION;
      claimTimer = setInterval(() => {
        remaining--;
        countdownEl.innerText = `‚è≥ Claiming in ${remaining} seconds...`;
        if (remaining <= 0) {
          clearInterval(claimTimer);
          claimTimer = null;
          coins += REWARD;
          views++;
          saveData();
          updateUI();
          countdownEl.innerText = "üéâ You earned 50 coins!";
          const coin = document.getElementById('coinSound');
          if (coin) coin.play().catch(e => {});
          claimBtn.disabled = false;
          claimBtn.classList.add('hidden');
          claimBtn.classList.remove('muted');
          watchBtn.disabled = false;
          watchBtn.classList.remove('muted');
        }
      }, 1000);
    }

    // ‚úÖ Fixed Auto Ad
    function startAutoAd() {
      document.getElementById("startAuto").classList.add("hidden");
      document.getElementById("stopAuto").classList.remove("hidden");
      document.getElementById("autoStatus").innerText = "‚ñ∂Ô∏è Auto Ad Running...";
      playAutoAd();
    }

    function stopAutoAd() {
      clearInterval(autoAdClaimTimeout);
      autoAdClaimTimeout = null;
      document.getElementById("startAuto").classList.remove("hidden");
      document.getElementById("stopAuto").classList.add("hidden");
      document.getElementById("autoStatus").innerText = "‚èπ Auto Ad Stopped";
    }

    function playAutoAd() {
      const countdownEl = document.getElementById('countdown');
      const watchBtn = document.getElementById('watchBtn');
      const claimBtn = document.getElementById('claimBtn');

      watchBtn.disabled = true;
      watchBtn.classList.add('muted');
      claimBtn.classList.add('hidden');

      let remaining = AD_DURATION;
      countdownEl.innerText = `‚è≥ Auto Ad playing ${remaining} sec...`;

      tryShowAd();

      autoAdClaimTimeout = setInterval(() => {
        if (!autoAdClaimTimeout) return;

        remaining--;
        countdownEl.innerText = `‚è≥ Auto Ad claiming in ${remaining} sec...`;

        if (remaining <= 0) {
          clearInterval(autoAdClaimTimeout);
          autoAdClaimTimeout = null;

          coins += REWARD;
          views++;
          saveData();
          updateUI();
          countdownEl.innerText = "üéâ Auto Ad Claimed +50 coins!";
          const coin = document.getElementById('coinSound');
          if (coin) coin.play().catch(e => {});

          // ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡¶ü‡ßã ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶¨‡ßá
          if (document.getElementById("stopAuto").classList.contains("hidden") === false) {
            setTimeout(playAutoAd, 2000);
          }
        }
      }, 1000);
    }

    // Withdraw/Referral Functions
    function showWithdraw(){ document.getElementById("withdraw-section").classList.remove("hidden"); document.getElementById("ad-section").classList.add("hidden"); document.getElementById("referral-section").classList.add("hidden"); }
    function calculateBDT(){ const amount = parseInt(document.getElementById("coinAmount").value) || 0; const bdt = (amount * 0.0038).toFixed(2); document.getElementById("bdtValue").innerText = `You will get: ${bdt} BDT`; }
    function submitWithdraw(){ alert("Withdraw Submit Logic Goes Here"); }
    function showReferral(){ document.getElementById("referral-section").classList.remove("hidden"); document.getElementById("withdraw-section").classList.add("hidden"); document.getElementById("ad-section").classList.add("hidden"); document.getElementById("refLink").innerText = `https://t.me/ads25_income_bot?start=${userId}`; }
    function copyReferral(){ navigator.clipboard.writeText(document.getElementById("refLink").innerText).then(()=>alert("Referral link copied!")); }
    function goBack(){ document.getElementById("withdraw-section").classList.add("hidden"); document.getElementById("referral-section").classList.add("hidden"); document.getElementById("ad-section").classList.remove("hidden"); updateUI(); }

    updateUI();
  </script>
</body>
</html>
