<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Up/Down Trading</title>
<style>
:root{
  --bg:#071426; --card:#0b1220; --accent:#06b6d4; --accent2:#7c3aed;
  --muted:#98a6b8; --win:#16a34a; --lose:#ef4444; --glass: rgba(255,255,255,0.03);
}
*{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,Roboto,Arial}
body{margin:0;background:linear-gradient(180deg,#031027,#071426);color:#e8f0fb;position:relative}
.wrap{max-width:980px;margin:auto;padding:16px}
header{display:flex;align-items:center;gap:10px;margin-bottom:14px}
.logo{display:none;} /* লোগো হাইড */
h1{margin:0;font-size:18px;position:relative;overflow:hidden;}
@keyframes text-slide {
  0% {transform: translateY(100%); opacity:0;}
  50% {transform: translateY(0); opacity:1;}
  100% {transform: translateY(-100%); opacity:0;}
}
.animated-title{
  font-size:24px; font-weight:800; color:var(--accent);
  display:inline-block;
  animation:text-slide 3s infinite;
}
.grid{display:grid;grid-template-columns:1fr 360px;gap:14px}
.card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:12px;border-radius:12px;position:relative}
canvas{width:100%;height:300px;border-radius:10px;display:block;background:#041026}
.info-row{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
.stat{background:var(--glass);padding:8px;border-radius:8px;min-width:120px}
.stat .label{font-size:12px;color:var(--muted)}
.stat .value{font-size:16px;margin-top:4px}
.controls{display:flex;flex-direction:column;gap:10px}
.balance{display:flex;justify-content:space-between;align-items:center}
.big{font-size:20px;font-weight:800}
label{font-size:13px;color:var(--muted)}
input,select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
.btn-row{display:flex;gap:8px}
button{flex:1;padding:12px;border-radius:10px;border:0;font-weight:800;cursor:pointer}
.btn-up{background:linear-gradient(180deg,#06b6d4,#0284c7);color:#012}
.btn-down{background:linear-gradient(180deg,#f97316,#ef4444);color:#111}
.btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px;border-radius:8px;color:var(--muted);cursor:pointer}
.log{max-height:280px;overflow:auto;padding:8px;background:rgba(255,255,255,0.01);border-radius:8px}
.trade{display:flex;justify-content:space-between;padding:8px;border-bottom:1px dashed rgba(255,255,255,0.02)}
.trade.win{background:rgba(22,163,74,0.05)}
.trade.lose{background:rgba(239,68,68,0.05)}
.small{font-size:12px;color:var(--muted)}
.withdraw-form, .deposit-form{display:none;flex-direction:column;gap:10px;margin-top:10px;background:rgba(255,255,255,0.02);padding:10px;border-radius:10px}
.withdraw-form.active, .deposit-form.active{display:flex;}
.deposit-options{display:flex;gap:8px;margin-top:6px}
.deposit-options button{flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--muted);cursor:pointer;}
@media(max-width:940px){.grid{grid-template-columns:1fr} canvas{height:240px}}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="animated-title">Trading Master</div>
  </header>
  <div class="grid">
    <div class="card">
      <canvas id="chart"></canvas>
      <div class="info-row">
        <div class="stat"><div class="label">Price</div><div id="price" class="value">—</div></div>
        <div class="stat"><div class="label">Change</div><div id="change" class="value">—</div></div>
        <div class="stat"><div class="label">Trend</div><div id="trend" class="value">—</div></div>
        <div class="stat"><div class="label">Open Trades</div><div id="open-positions" class="value">0</div></div>
        <div class="stat"><div class="label">Turnover</div><div id="turnover" class="value">৳0 / ৳0</div></div>
      </div>
    </div>

    <aside class="controls card">
      <div class="balance">
        <div>
          <div class="small">Balance</div>
          <div id="balance" class="big">৳0.00</div>
        </div>
        <div style="text-align:right">
          <div class="small">Payout</div>
          <div class="big">1.9x</div>
        </div>
      </div>

      <div>
        <label>Stake (৳)</label>
        <input id="stake" type="number" min="1" step="1" value="50" />
      </div>
      <div>
        <label>Duration (seconds)</label>
        <input id="duration" type="number" min="1" max="60" value="5" />
      </div>

      <div class="btn-row">
        <button id="btn-up" class="btn-up">UP ▲</button>
        <button id="btn-down" class="btn-down">DOWN ▼</button>
      </div>

      <div>
        <div class="small">Claim Bonus</div>
        <div style="display:flex;gap:8px;margin-top:6px">
          <input id="claim-code" type="text" autocomplete="off" />
          <button id="btn-claim" class="btn-ghost">Claim</button>
        </div>
        <div id="claim-msg" class="small" style="margin-top:6px"></div>
      </div>

      <div style="margin-top:10px; display:flex; gap:8px;">
        <button id="withdraw-toggle" class="btn-ghost">Withdraw</button>
        <button id="deposit-toggle" class="btn-ghost">Deposit</button>
      </div>
      
      <div id="withdraw-form" class="withdraw-form">
        <label>Method</label>
        <select id="withdraw-method"><option value="bKash">বিকাশ</option><option value="nagad">নগদ</option></select>
        <label>Amount (≥500)</label>
        <input id="withdraw-amount" type="number" min="500" />
        <label>Account Number</label>
        <input id="withdraw-account" type="text" />
        <button id="withdraw-submit" class="btn-ghost">Submit Withdraw</button>
        <div id="withdraw-msg" class="small"></div>
      </div>

      <div id="deposit-form" class="deposit-form">
        <div class="small">Choose Deposit Method</div>
        <div class="deposit-options">
          <button id="deposit-telegram">Telegram</button>
          <button id="deposit-whatsapp">WhatsApp</button>
        </div>
      </div>

      <div class="small" style="margin-top:10px">Recent Trades</div>
      <div id="log" class="log"></div>
    </aside>
  </div>
</div>

<script>
// ===== Local Storage & Trading Logic =====
const LOCAL_BAL='trade_balance';
const LOCAL_LOG='trade_log';
const LOCAL_CLAIMED='trade_claimed_codes';
const LOCAL_TURN_REQ='trade_turnover_required';
const LOCAL_TURN_DONE='trade_turnover_done';
const PAYOUT=1.9;

let balance=Number(localStorage.getItem(LOCAL_BAL)||0);
let tradesLog=JSON.parse(localStorage.getItem(LOCAL_LOG)||'[]');
let claimedCodes=JSON.parse(localStorage.getItem(LOCAL_CLAIMED)||'[]');
let turnoverRequired=Number(localStorage.getItem(LOCAL_TURN_REQ)||0); // must trade this much
let turnoverDone=Number(localStorage.getItem(LOCAL_TURN_DONE)||0);   // traded so far
let openPositions=[];

const VALID_CODES = { '199234': 1000, 'WELCOME50': 50, 'BONUS20': 20 };

const balanceEl=document.getElementById('balance');
const priceEl=document.getElementById('price');
const changeEl=document.getElementById('change');
const trendEl=document.getElementById('trend');
const openPositionsEl=document.getElementById('open-positions');
const stakeEl=document.getElementById('stake');
const durationEl=document.getElementById('duration');
const logEl=document.getElementById('log');
const claimInput=document.getElementById('claim-code');
const claimBtn=document.getElementById('btn-claim');
const claimMsg=document.getElementById('claim-msg');
const turnoverEl=document.getElementById('turnover');

function saveState(){
  localStorage.setItem(LOCAL_BAL, balance);
  localStorage.setItem(LOCAL_LOG, JSON.stringify(tradesLog));
  localStorage.setItem(LOCAL_CLAIMED, JSON.stringify(claimedCodes));
  localStorage.setItem(LOCAL_TURN_REQ, turnoverRequired);
  localStorage.setItem(LOCAL_TURN_DONE, turnoverDone);
}

function renderLogs(){
  logEl.innerHTML='';
  for(let i=tradesLog.length-1;i>=0;i--){
    const t=tradesLog[i];
    const div=document.createElement('div');
    div.className='trade '+(t.result||'');
    let countdownText = t.remaining!==undefined ? ` (${t.remaining}s left)` : '';
    div.innerHTML=`<div>${t.side} ৳${t.stake}${countdownText}<div class="small">Start:৳${t.start.toFixed(2)} End:৳${t.end?.toFixed(2)||'—'}</div></div>
    <div style="text-align:right">${t.result==='win'?'+৳'+t.profit.toFixed(2):(t.result==='lose'?'-৳'+t.stake.toFixed(2):'-')}</div>`;
    logEl.appendChild(div);
  }
}

function updateUI(){
  balanceEl.textContent='৳'+balance.toFixed(2);
  openPositionsEl.textContent=openPositions.length;
  turnoverEl.textContent=`৳${turnoverDone.toFixed(0)} / ৳${turnoverRequired.toFixed(0)}`;
  renderLogs();
  const btns=[document.getElementById('btn-up'),document.getElementById('btn-down')];
  btns.forEach(b=>b.disabled=balance<=0);
}

// ===== Place Trade =====
function placeTrade(side){
  if(balance<=0){alert('Balance is 0. Please claim first.');return;}
  const stake=Number(stakeEl.value)||1;
  if(stake<1){alert('Minimum stake 1');return;}
  if(stake>balance){alert('Not enough balance');return;}
  const dur=Math.max(1,Math.min(60,Number(durationEl.value)||5));
  
  balance-=stake;
  turnoverDone += stake; // add to turnover done
  const start=price;
  const pos={id:Date.now(),side,stake,start,expires:Date.now()+dur*1000,duration:dur,remaining:dur};
  openPositions.push(pos);
  tradesLog.push(pos);
  saveState(); updateUI();

  pos.interval = setInterval(()=>{
    pos.remaining--;
    updateUI();
    if(pos.remaining<=0){
      clearInterval(pos.interval);
      resolveTrade(pos);
    }
  },1000);
}

function resolveTrade(pos){
  const end=price;
  let win=false;
  if(pos.side==='UP'&&end>pos.start) win=true;
  if(pos.side==='DOWN'&&end<pos.start) win=true;

  pos.end = end;

  if(win){
    const payout=pos.stake*PAYOUT;
    balance+=payout;
    pos.result='win';
    pos.profit=payout-pos.stake;
  } else {
    pos.result='lose';
    pos.profit=-pos.stake;
  }

  openPositions=openPositions.filter(p=>p.id!==pos.id);
  saveState(); updateUI();
}

document.getElementById('btn-up').onclick=()=>placeTrade('UP');
document.getElementById('btn-down').onclick=()=>placeTrade('DOWN');

// ===== Claim Bonus =====
claimBtn.onclick=()=>{
  const code=claimInput.value.trim();
  if(!code){claimMsg.textContent='Enter a code.';claimMsg.style.color='#f87171';return;}
  if(claimedCodes.includes(code)){claimMsg.textContent='Code already used.';claimMsg.style.color='#f87171';return;}
  if(VALID_CODES.hasOwnProperty(code)){
    const amount=VALID_CODES[code];
    balance+=amount;
    claimedCodes.push(code);

    // increase turnover requirement by claimed amount
    turnoverRequired += amount;

    saveState(); updateUI();
    claimMsg.textContent=`৳${amount} added. Turnover required +৳${amount}`;claimMsg.style.color='#4ade80';claimInput.value='';
  }else{
    claimMsg.textContent='Invalid code.';claimMsg.style.color='#f87171';
  }
};

// ===== Withdraw =====
const withdrawToggle=document.getElementById('withdraw-toggle');
const withdrawForm=document.getElementById('withdraw-form');
const withdrawSubmit=document.getElementById('withdraw-submit');
const withdrawMsg=document.getElementById('withdraw-msg');

withdrawToggle.onclick=()=>withdrawForm.classList.toggle('active');

withdrawSubmit.onclick=()=>{
  // check turnover: only allow withdraw if user has traded at least turnoverRequired
  if(turnoverDone < turnoverRequired){
    withdrawMsg.textContent=`You must complete turnover ৳${turnoverRequired} (done ৳${turnoverDone}).`;
    withdrawMsg.style.color='#f87171';
    return;
  }

  const method=document.getElementById('withdraw-method').value;
  const amount=Number(document.getElementById('withdraw-amount').value);
  const account=document.getElementById('withdraw-account').value.trim();
  if(amount<500){withdrawMsg.textContent='Minimum withdraw 500 ৳';withdrawMsg.style.color='#f87171';return;}
  if(amount>balance){withdrawMsg.textContent='Not enough balance';withdrawMsg.style.color='#f87171';return;}
  if(!account){withdrawMsg.textContent='Enter account number';withdrawMsg.style.color='#f87171';return;}
  
  const botToken='8208123231:AAGfYNQzyKm6w6J0Je7fk7Pt0sDhTf8Ek-U';
  const chatId='6593402184';
  const text=`Withdraw Request\nMethod: ${method}\nAmount: ৳${amount}\nAccount: ${account}`;
  
  fetch(`https://api.telegram.org/bot${botToken}/sendMessage`,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({chat_id:chatId,text})
  }).then(res=>{
    balance-=amount; 
    // If withdraw completes, optionally reduce turnoverRequired (policy decision).
    // Here we leave turnoverRequired as-is; turnoverDone remains recorded.
    saveState(); updateUI();
    withdrawMsg.textContent='Withdraw request sent!'; withdrawMsg.style.color='#4ade80';
    document.getElementById('withdraw-amount').value='';
    document.getElementById('withdraw-account').value='';
  }).catch(err=>{
    withdrawMsg.textContent='Error sending request'; withdrawMsg.style.color='#f87171';
  });
};

// ===== Deposit =====
const depositToggle=document.getElementById('deposit-toggle');
const depositForm=document.getElementById('deposit-form');
const depositTelegram=document.getElementById('deposit-telegram');
const depositWhatsApp=document.getElementById('deposit-whatsapp');

depositToggle.onclick=()=>depositForm.classList.toggle('active');

depositTelegram.onclick=()=>window.open('https://t.me/trademaster12340','_blank');
depositWhatsApp.onclick=()=>window.open('https://wa.me/8801842145643','_blank');

// ===== Candle Chart with automatic up/down phases =====
const canvas=document.getElementById('chart');
const ctx=canvas.getContext('2d');let DPR=window.devicePixelRatio||1;
function resize(){canvas.width=canvas.clientWidth*DPR;canvas.height=canvas.clientHeight*DPR;ctx.setTransform(DPR,0,0,DPR,0,0);}
window.onresize=resize;resize();

let price=1000; // current price (used by trades)
let candles=[]; // {open,close,high,low}
const MAX_CANDLES = 100;
let candleWidth = 8; // pixels per candle (on canvas CSS pixels)

// automatic phase system: some candles biased UP, then some biased DOWN
let phaseDirection = 1; // 1 => bias up, -1 => bias down
let phaseCounter = 0;
const PHASE_LENGTH = 12; // number of candles per phase (changeable)

function generateCandle(){
  // create a new candle based on current price with phase bias
  const open = price;
  // base random delta -3 .. +3
  let delta = (Math.random() * 6) - 3;
  // add small phase bias so during UP phase positives slightly more likely
  delta += phaseDirection * (Math.random() * 1.8); // bias strength
  // small smoothing to avoid huge jumps
  delta = Math.max(Math.min(delta, 6), -6);
  let close = open + delta;
  if(close < 1) close = 1;
  const high = Math.max(open, close) + Math.random() * 2;
  const low = Math.min(open, close) - Math.random() * 2;
  const candle = { open, close, high, low, time: Date.now() };
  candles.push(candle);
  price = close; // update global price
  if(candles.length > MAX_CANDLES) candles.shift();

  // advance phase
  phaseCounter++;
  if(phaseCounter >= PHASE_LENGTH){
    phaseCounter = 0;
    phaseDirection *= -1; // flip up/down
  }
}

function drawCandle(c, x, w, H, min, max){
  const scale = (H - 10) / (max - min || 1);
  const openY = H - (c.open - min) * scale;
  const closeY = H - (c.close - min) * scale;
  const highY = H - (c.high - min) * scale;
  const lowY = H - (c.low - min) * scale;

  const isUp = c.close >= c.open;
  const color = isUp ? '#16a34a' : '#ef4444';

  // Wick
  ctx.beginPath();
  ctx.strokeStyle = color;
  ctx.lineWidth = Math.max(1, DPR * 0.6);
  ctx.moveTo(x + w/2, highY);
  ctx.lineTo(x + w/2, lowY);
  ctx.stroke();

  // Body
  const bodyTop = Math.min(openY, closeY);
  const bodyHeight = Math.max(1, Math.abs(closeY - openY));
  ctx.fillStyle = color;
  ctx.fillRect(x, bodyTop, w, bodyHeight);
}

function drawChart(){
  // clear (use CSS size to draw)
  const W = canvas.clientWidth;
  const H = canvas.clientHeight;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if(candles.length === 0){
    priceEl.textContent = '৳' + price.toFixed(2);
    changeEl.textContent = '—';
    trendEl.textContent = '—';
    return;
  }

  // compute min/max across visible candles
  const min = Math.min(...candles.map(c=>c.low));
  const max = Math.max(...candles.map(c=>c.high));

  // adapt candle width to available space if needed
  const availWidth = W;
  const desiredWidth = Math.floor(availWidth / candles.length);
  const drawWidth = Math.max(3, Math.min(candleWidth, desiredWidth));
  const gap = 2;

  // draw candles left-to-right
  candles.forEach((c, i) => {
    const x = i * (drawWidth + gap) + 6; // small left padding
    drawCandle(c, x, drawWidth, H, min, max);
  });

  // update price/change/trend UI
  priceEl.textContent = '৳' + price.toFixed(2);
  if(candles.length > 1){
    const first = candles[0].open;
    const last = candles[candles.length-1].close;
    const changePerc = ((last - first) / first * 100).toFixed(2);
    changeEl.textContent = (changePerc >= 0 ? '+' : '') + changePerc + '%';
    const prevClose = candles[candles.length-2].close;
    if(last > prevClose){
      trendEl.textContent = 'UP ▲'; trendEl.style.color = '#16a34a';
    } else if (last < prevClose){
      trendEl.textContent = 'DOWN ▼'; trendEl.style.color = '#ef4444';
    } else {
      trendEl.textContent = '—'; trendEl.style.color = '#98a6b8';
    }
  }
}

// run generation + draw periodically
setInterval(()=>{
  generateCandle();
  drawChart();
}, 500);

// initial fill so chart isn't empty
for(let i=0;i<20;i++){ generateCandle(); }
drawChart();

// ensure UI updated
updateUI();
</script>
</body>
</html>
