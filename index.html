<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Up/Down Trading</title>
<style>
:root{
  --bg:#071426; --card:#0b1220; --accent:#06b6d4; --accent2:#7c3aed;
  --muted:#98a6b8; --win:#16a34a; --lose:#ef4444; --glass: rgba(255,255,255,0.03);
}
*{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,Roboto,Arial}
body{margin:0;background:linear-gradient(180deg,#031027,#071426);color:#e8f0fb;position:relative}
.wrap{max-width:980px;margin:auto;padding:16px}
header{display:flex;align-items:center;gap:10px;margin-bottom:14px}
.logo{display:none;}
h1{margin:0;font-size:18px;position:relative;overflow:hidden;}
.animated-title{font-size:24px;font-weight:800;color:var(--accent);display:inline-block;}
.grid{display:grid;grid-template-columns:1fr 360px;gap:14px}
.card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:12px;border-radius:12px;position:relative}
canvas{width:100%;height:300px;border-radius:10px;display:block;background:#041026}
.info-row{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
.stat{background:var(--glass);padding:8px;border-radius:8px;min-width:120px}
.stat .label{font-size:12px;color:var(--muted)}
.stat .value{font-size:16px;margin-top:4px}
.controls{display:flex;flex-direction:column;gap:10px}
.balance{display:flex;justify-content:space-between;align-items:center}
.big{font-size:20px;font-weight:800}
label{font-size:13px;color:var(--muted)}
input,select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
.btn-row{display:flex;gap:8px}
button{flex:1;padding:12px;border-radius:10px;border:0;font-weight:800;cursor:pointer}
.btn-up{background:linear-gradient(180deg,#06b6d4,#0284c7);color:#012}
.btn-down{background:linear-gradient(180deg,#f97316,#ef4444);color:#111}
.btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px;border-radius:8px;color:var(--muted);cursor:pointer}
.log{max-height:280px;overflow:auto;padding:8px;background:rgba(255,255,255,0.01);border-radius:8px}
.trade{display:flex;justify-content:space-between;padding:8px;border-bottom:1px dashed rgba(255,255,255,0.02)}
.trade.win{background:rgba(22,163,74,0.05)}
.trade.lose{background:rgba(239,68,68,0.05)}
.small{font-size:12px;color:var(--muted)}
.withdraw-form, .deposit-form{display:none;flex-direction:column;gap:10px;margin-top:10px;background:rgba(255,255,255,0.02);padding:10px;border-radius:10px}
.withdraw-form.active, .deposit-form.active{display:flex;}
.deposit-options{display:flex;gap:8px;margin-top:6px}
.deposit-options button{flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--muted);cursor:pointer;}
@media(max-width:940px){.grid{grid-template-columns:1fr} canvas{height:240px}}
</style>
</head>
<body>
<div class="wrap">
  <header><div class="animated-title">Trading Master</div></header>
  <div class="grid">
    <div class="card">
      <canvas id="chart"></canvas>
      <div class="info-row">
        <div class="stat"><div class="label">Price</div><div id="price" class="value">—</div></div>
        <div class="stat"><div class="label">Change</div><div id="change" class="value">—</div></div>
        <div class="stat"><div class="label">Trend</div><div id="trend" class="value">—</div></div>
        <div class="stat"><div class="label">Open Trades</div><div id="open-positions" class="value">0</div></div>
      </div>
    </div>
    <aside class="controls card">
      <div class="balance">
        <div><div class="small">Balance</div><div id="balance" class="big">৳0.00</div></div>
        <div style="text-align:right"><div class="small">Payout</div><div class="big">1.9x</div></div>
      </div>
      <div><label>Stake (৳)</label><input id="stake" type="number" min="1" step="1" value="50" /></div>
      <div><label>Duration (seconds)</label><input id="duration" type="number" min="1" max="60" value="5" /></div>
      <div class="btn-row"><button id="btn-up" class="btn-up">UP ▲</button><button id="btn-down" class="btn-down">DOWN ▼</button></div>
      <div class="small" style="margin-top:10px">Recent Trades</div>
      <div id="log" class="log"></div>
    </aside>
  </div>
</div>

<script>
// === Trading Variables ===
const LOCAL_BAL='trade_balance';
const LOCAL_LOG='trade_log';
const PAYOUT=1.9;
let balance=Number(localStorage.getItem(LOCAL_BAL)||0);
let tradesLog=JSON.parse(localStorage.getItem(LOCAL_LOG)||'[]');
let openPositions=[];

// === UI Refs ===
const balanceEl=document.getElementById('balance');
const priceEl=document.getElementById('price');
const changeEl=document.getElementById('change');
const trendEl=document.getElementById('trend');
const openPositionsEl=document.getElementById('open-positions');
const stakeEl=document.getElementById('stake');
const durationEl=document.getElementById('duration');
const logEl=document.getElementById('log');

function saveState(){ localStorage.setItem(LOCAL_BAL,balance); localStorage.setItem(LOCAL_LOG,JSON.stringify(tradesLog)); }
function renderLogs(){
  logEl.innerHTML='';
  for(let i=tradesLog.length-1;i>=0;i--){
    const t=tradesLog[i];
    const div=document.createElement('div');
    div.className='trade '+(t.result||'');
    div.innerHTML=`<div>${t.side} ৳${t.stake}<div class="small">Open:${t.start.toFixed(2)} Close:${t.end?.toFixed(2)||'—'}</div></div>
    <div style="text-align:right">${t.result==='win'?'+৳'+t.profit.toFixed(2):(t.result==='lose'?'-৳'+t.stake.toFixed(2):'-')}</div>`;
    logEl.appendChild(div);
  }
}
function updateUI(){ balanceEl.textContent='৳'+balance.toFixed(2); openPositionsEl.textContent=openPositions.length; renderLogs(); }

// === Trading Logic ===
function placeTrade(side){
  const stake=Number(stakeEl.value)||1;
  const dur=Math.max(1,Math.min(60,Number(durationEl.value)||5));
  if(stake>balance){alert('Not enough balance');return;}
  balance-=stake;
  const start=candles.at(-1).open;
  const pos={id:Date.now(),side,stake,start,duration:dur,expires:Date.now()+dur*1000};
  openPositions.push(pos); tradesLog.push(pos);
  saveState(); updateUI();
  setTimeout(()=>resolveTrade(pos),dur*1000);
}
function resolveTrade(pos){
  const end=candles.at(-1).close;
  pos.end=end;
  let win=false;
  if(pos.side==='UP' && end>pos.start) win=true;
  if(pos.side==='DOWN' && end<pos.start) win=true;
  if(win){ const payout=pos.stake*PAYOUT; balance+=payout; pos.result='win'; pos.profit=payout-pos.stake; }
  else { pos.result='lose'; pos.profit=-pos.stake; }
  openPositions=openPositions.filter(p=>p.id!==pos.id); saveState(); updateUI();
}
document.getElementById('btn-up').onclick=()=>placeTrade('UP');
document.getElementById('btn-down').onclick=()=>placeTrade('DOWN');

// === Candle Chart ===
const canvas=document.getElementById('chart'); const ctx=canvas.getContext('2d');
let DPR=window.devicePixelRatio||1;
function resize(){canvas.width=canvas.clientWidth*DPR;canvas.height=canvas.clientHeight*DPR;ctx.setTransform(DPR,0,0,DPR,0,0);}
window.onresize=resize;resize();

let price=1000;
let candles=[{open:price,high:price,low:price,close:price}];
let tick=0; let tickPerCandle=10; // প্রতি 10 টিক এ 1 ক্যান্ডেল

function step(){
  const last=candles[candles.length-1];
  let move=(Math.random()*3+1)*(Math.random()<0.5?-1:1);
  price=Math.max(1,price+move);
  last.high=Math.max(last.high,price);
  last.low=Math.min(last.low,price);
  last.close=price;
  tick++;
  if(tick>=tickPerCandle){ // নতুন ক্যান্ডেল
    candles.push({open:price,high:price,low:price,close:price});
    if(candles.length>60) candles.shift();
    tick=0;
  }
  priceEl.textContent='৳'+price.toFixed(2);
  trendEl.textContent=move>0?'UP ▲':(move<0?'DOWN ▼':'—');
  trendEl.style.color=move>0?'#16a34a':(move<0?'#ef4444':'#98a6b8');
  if(candles.length>2){ const change=((candles.at(-1).close-candles[0].open)/candles[0].open*100).toFixed(2);
    changeEl.textContent=(change>=0?'+':'')+change+'%'; }
}
function draw(){
  const W=canvas.clientWidth,H=canvas.clientHeight;
  ctx.clearRect(0,0,W,H);
  const minY=Math.min(...candles.map(c=>c.low)), maxY=Math.max(...candles.map(c=>c.high));
  const candleW=W/candles.length-2;
  candles.forEach((c,i)=>{
    const x=i*(candleW+2)+2;
    const yOpen=H-(c.open-minY)/(maxY-minY)*H;
    const yClose=H-(c.close-minY)/(maxY-minY)*H;
    const yHigh=H-(c.high-minY)/(maxY-minY)*H;
    const yLow=H-(c.low-minY)/(maxY-minY)*H;
    const color=c.close>=c.open?'#16a34a':'#ef4444';
    ctx.strokeStyle=color; ctx.beginPath(); ctx.moveTo(x+candleW/2,yHigh); ctx.lineTo(x+candleW/2,yLow); ctx.stroke();
    ctx.fillStyle=color; ctx.fillRect(x,Math.min(yOpen,yClose),candleW,Math.abs(yClose-yOpen)||2);
  });
}
setInterval(()=>{step();draw();},500);
updateUI();
</script>
</body>
</html>
